<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Panel</title>
    <link
        href="https://cdn.jsdelivr.net/npm/tailwindcss@2.1.2/dist/tailwind.min.css"
        rel="stylesheet"
    />
    <style>
        th {
            background-color: #3b82f6; 
            color: white;
        }
        td, th {
            text-align: left; 
            padding: 12px; 
        }
        table {
            border-collapse: collapse; 
            width: 100%; 
            table-layout: fixed;
        }
        tr:nth-child(even) {
            background-color: #f3f4f6; 
        }
        .active {
            background-color: #3b82f6;
        }
        .submenu {
            display: none;
            padding-left: 1rem; 
        }
        #editModal .modal-content {
            max-height: 60vh; 
            overflow-y: auto;
        }
        .search-bar {
            width: 30%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }   
        .table-container {
            max-height: 650px;
            overflow-y: auto;
            overflow-x: auto;
            width: 100%; 
        }
        td {
            max-width: 150px;         
            overflow: hidden;               
            text-overflow: ellipsis;
        }
        th {
            word-wrap: break-word;
            padding: 8px;
            position: sticky;
            top: 0;
        }
        .pagination-controls {
        position: sticky;
        bottom: 0;
        background-color: white;
        padding: 20px;
        text-align: right;
        border-top: 1px solid #bbcff5;
        }
        .pagination-controls button {
            background-color: #3b82f6;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }
        .pagination-controls button:hover {
            background-color: #2962be;
        }
        .pagination-controls button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="flex">
        <div class="w-64 h-screen bg-blue-900 text-white flex flex-col justify-between">
            <div>
                <div class="p-6">
                    <h1 class="text-2xl font-bold">Admin Panel</h1>
                </div>
                <nav class="mt-10">
                    <a 
                        id="manageUsersLink"
                        href="#"
                        class="block py-2.5 px-4 rounded transition duration-200 hover:bg-blue-800"
                    >
                        Manage Users
                    </a>
                    <div id="usersSubMenu" class="submenu">
                         <a href="#" id="approveOrganizationsLink" class="block py-2 px-4 rounded transition duration-200 hover:bg-blue-800">
                        Approve Organizations
                    </a>
                        
                        <a href="#" id="banDeleteUsersLink" class="block py-2 px-4 rounded transition duration-200 hover:bg-blue-800">Ban/Delete Participant</a>
                        <a href="#" id="banDeleteOrgLink" class="block py-2 px-4 rounded transition duration-200 hover:bg-blue-800">Ban/Delete Organization</a>
                    </div> 
                    <div>
                        <a
                            id="manageCardsLink"
                            href="#"
                            class="block py-2.5 px-4 rounded transition duration-200 hover:bg-blue-800"
                        >
                            Manage Cards
                        </a>
                        <div id="cardsSubMenu" class="submenu">
                            <a href="#" id="internshipsLink" class="block py-2 px-4 rounded transition duration-200 hover:bg-blue-800">Internships</a>
                            <a href="#" id="trainingsLink" class="block py-2 px-4 rounded transition duration-200 hover:bg-blue-800">Trainings</a>
                            <a href="#" id="volunteeringLink" class="block py-2 px-4 rounded transition duration-200 hover:bg-blue-800">Volunteering</a>
                            <a href="#" id="eventsLink" class="block py-2 px-4 rounded transition duration-200 hover:bg-blue-800">Events</a>
                        </div>
                    </div>

                    <a 
                        id="manageFeedbackLink" 
                        href="#" 
                        class="block py-2.5 px-4 rounded transition duration-200 hover:bg-blue-800"
                    >
                        Manage Feedback
                    </a>
                    <div id="feedbackSubMenu" class="submenu">
                        <a href="#" id="manageReviewsLink" class="block py-2 px-4 rounded transition duration-200 hover:bg-blue-800">Manage Reviews</a>
                        <a href="#" id="manageTestimonialsLink" class="block py-2 px-4 rounded transition duration-200 hover:bg-blue-800">Manage Testimonials</a>
                    </div>
                    
                </nav>
            </div>

            <div class="p-6">
                <button
                    id="logoutButton"
                    class="block py-2.5 px-4 rounded bg-red-600 hover:bg-red-800 w-full text-white"
                >
                    Log out
                </button>
            </div>
        </div>

        <div class="flex-1 p-6">
            <h2 id="greeting" class="text-3xl font-semibold mb-6">Welcome, Admin!</h2>
            <p id="greetingDescription" class="text-gray-700 mb-6">This is your admin dashboard where you can manage Users, Cards, or Reviews.</p>

            <div id="approveOrganizationsTableContainer" style="display: none;">
                <h2 class="text-2xl font-bold mb-4" id="approveOrganizationsHeader">Approve Organizations</h2>
                <input type="text" id="approveOrganizationsSearch" placeholder="Search..." class="search-bar">
                <table class="min-w-full bg-white" id="approveOrganizationsTable">
                    <thead>
                        <tr id="approveOrganizationsTableHeader">
                        </tr>
                    </thead>
                    <tbody id="approveOrganizationsTableBody">
                    </tbody>
                </table>
            </div>

            <div id="banDeleteUsersTableContainer" class="table-container" style="display: none;">
                <h2 class="text-2xl font-bold mb-4" id="banDeleteUsersHeader">Ban/Delete Participant</h2>
                <input type="text" id="banDeleteUsersSearch" placeholder="Search participants..." class="search-bar">
                <table class="min-w-full bg-white" id="banDeleteUsersTable">
                    <thead>
                        <tr id="banDeleteUsersTableHeader">
                            <th class="py-2 px-4 border-b">Username</th>
                            <th class="py-2 px-4 border-b">Email</th>
                            <th class="py-2 px-4 border-b">Phone</th>
                            <th class="py-2 px-4 border-b">Status</th>
                            <th class="py-2 px-4 border-b">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="banDeleteUsersTableBody">
                    </tbody>
                </table>
            </div>
            
            <div id="banDeleteOrgTableContainer" class="table-container" style="display: none;">
                <h2 class="text-2xl font-bold mb-4" id="banDeleteOrgHeader">Ban/Delete Organization</h2>
                <input type="text" id="banDeleteOrgSearch" placeholder="Search organization..." class="search-bar">
                <table class="min-w-full bg-white" id="banDeleteOrgTable">
                    <thead>
                        <tr id="banDeleteOrgTableHeader">
                            <th class="py-2 px-4 border-b">Organization Name</th>
                            <th class="py-2 px-4 border-b">Email</th>
                            <th class="py-2 px-4 border-b">Phone Number</th>
                            <th class="py-2 px-4 border-b">Website URL</th>
                            <th class="py-2 px-4 border-b">Description</th>
                            <th class="py-2 px-4 border-b">Status</th>
                            <th class="py-2 px-4 border-b">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="banDeleteOrgTableBody">
                    </tbody>
                </table>
            </div>


           <div id="approveOrganizationsTableContainer" class="table-container" style="display: none;">
                <h2 class="text-2xl font-bold mb-4">Approve Organizations</h2>
                <table class="min-w-full bg-white">
                    <thead>
                        <tr>
                            <th class="border-b">Organization Name</th>
                            <th class="border-b">Email</th>
                            <th class="border-b">Phone Number</th>
                            <th class="border-b">Website URL</th>
                            <th class="border-b">Description</th>
                            <th class="border-b">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="approveOrganizationsTableBody">
                    </tbody>
                </table>
            </div>

            <script>
                function showApproveOrganizations() {
                    const container = document.getElementById("approveOrganizationsTableContainer");
                    container.style.display = (container.style.display === "none" || container.style.display === "") ? "block" : "none";
                }
            </script>

        <div id="cardsTableContainer" class="table-container"  style="display: none;">
            <h2 class="text-2xl font-bold mb-4" id="cardsHeader">Manage Cards</h2>
            <input type="text" id="cardsSearch" placeholder="Search..." class="search-bar">
            <table class="min-w-full bg-white" id="cardsTable">
                <thead>
                    <tr id="cardsTableHeader">
                    </tr>
                </thead>
                <tbody id="cardsTableBody">
                </tbody>
            </table>
            <div id="paginationControls" class="pagination-controls"></div>
        </div>


        <div id="editModal" class="fixed inset-0 bg-gray-800 bg-opacity-75 hidden flex items-center justify-center">
            <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-lg">
                <h2 class="text-xl font-bold mb-4 text-center">Edit Card</h2>
                <div class="modal-content"> 
                    <form id="editForm" class="space-y-4">
                    </form>
                </div>
                <div class="flex justify-end gap-4 mt-4">
                    <button id="cancelButton" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition">
                        Cancel
                    </button>
                    <button id="saveButton" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition">
                        Save
                    </button>
                </div>
            </div>
        </div>

        <!-- Manage Reviews Table -->
        <div id="manageReviewsTableContainer" class="table-container" style="display: none;">
            <h2 class="text-2xl font-bold mb-4" id="manageReviewsHeader">Manage Reviews</h2>
            <input type="text" id="reviewsSearch" placeholder="Search reviews..." class="search-bar">
            <table class="min-w-full bg-white" id="reviewsTable">
                <thead>
                    <tr>
                        <th class="py-2 px-4 border-b">Username</th>
                        <th class="py-2 px-4 border-b">Review</th>
                        <th class="py-2 px-4 border-b">Actions</th>
                    </tr>
                </thead>
                <tbody id="reviewsTableBody">
                </tbody>
            </table>
        </div>

        <!-- Manage Testimonials Table -->
        <div id="manageTestimonialsTableContainer" class="table-container" style="display: none;">
            <h2 class="text-2xl font-bold mb-4" id="manageTestimonialsHeader">Manage Testimonials</h2>
            <input type="text" id="testimonialsSearch" placeholder="Search testimonials..." class="search-bar">
            <table class="min-w-full bg-white" id="testimonialsTable">
                <thead>
                    <tr>
                        <th class="py-2 px-4 border-b">Username</th>
                        <th class="py-2 px-4 border-b">Testimonial</th>
                        <th class="py-2 px-4 border-b">Actions</th>
                    </tr>
                </thead>
                <tbody id="testimonialsTableBody">
                </tbody>
            </table>
        </div>


    <script>
        
            function filterTable(searchInputId, tableId) {
                const searchInput = document.getElementById(searchInputId);
                const table = document.getElementById(tableId);
                const rows = table.getElementsByTagName('tr');

                searchInput.addEventListener('input', function() {
                    const query = searchInput.value.toLowerCase();
                    
                    if (query === "") {
                        for (let i = 0; i < rows.length; i++) {
                            rows[i].style.display = '';
                        }
                    } else {
                        for (let i = 0; i < rows.length; i++) {
                            const row = rows[i];
                            const cells = row.getElementsByTagName('td');
                            let match = false;
                            
                            for (let j = 0; j < cells.length; j++) {
                                const cell = cells[j];
                                if (cell.textContent.toLowerCase().includes(query)) {
                                    match = true;
                                    break;
                                }
                            }
                            
                            if (match) {
                                row.style.display = '';
                            } else {
                                row.style.display = 'none';
                            }
                        }
                    }
                });
            }


            function resetSearchInput() {
                const searchInput = document.getElementById('cardsSearch');
                if (searchInput) {
                    searchInput.value = '';
                }
            }

            function handleSubMenuClick() {
                resetSearchInput();
            }

            function showTableAndSearch(tableId, searchInputId) {
                const tableContainer = document.getElementById(tableId);
                const searchInput = document.getElementById(searchInputId);

                tableContainer.style.display = (tableContainer.style.display === "none" || tableContainer.style.display === "") ? "block" : "none";
                searchInput.style.display = (tableContainer.style.display === "block") ? "block" : "none";
            }

            document.getElementById('internshipsLink').addEventListener('click', function(event) {
                event.preventDefault();
                handleSubMenuClick();
                showTableAndSearch('internshipsTableContainer', 'internshipsSearch');
            });

            document.getElementById('trainingsLink').addEventListener('click', function(event) {
                event.preventDefault();
                handleSubMenuClick();
                showTableAndSearch('trainingsTableContainer', 'trainingsSearch');
            });

            document.getElementById('volunteeringLink').addEventListener('click', function(event) {
                event.preventDefault();
                handleSubMenuClick();
                showTableAndSearch('volunteeringTableContainer', 'volunteeringSearch');
            });

            document.getElementById('eventsLink').addEventListener('click', function(event) {
                event.preventDefault();
                handleSubMenuClick();
                showTableAndSearch('eventsTableContainer', 'eventsSearch');
            });

            document.getElementById('banDeleteUsersLink').addEventListener('click', function(event) {
                event.preventDefault();
                handleSubMenuClick();
                showTableAndSearch('banDeleteUsersTableContainer', 'banDeleteUsersSearch');
            });

            document.getElementById('banDeleteOrgLink').addEventListener('click', function(event) {
                event.preventDefault();
                handleSubMenuClick();
                showTableAndSearch('banDeleteOrgTableContainer', 'banDeleteOrgSearch');
            });

            document.getElementById('approveOrganizationsLink').addEventListener('click', function(event) {
                event.preventDefault();
                handleSubMenuClick();
                showTableAndSearch('approveOrganizationsTableContainer', 'approveOrganizationsSearch');
            });

            document.getElementById('manageReviewsLink').addEventListener('click', function(event) {
                event.preventDefault();
                handleSubMenuClick();
                showTableAndSearch('manageReviewsTableContainer', 'reviewsSearch');
            });

            document.getElementById('manageTestimonialsLink').addEventListener('click', function(event) {
                event.preventDefault();
                handleSubMenuClick();
                showTableAndSearch('manageTestimonialsTableContainer', 'testimonialsSearch');
            });

            document.getElementById('banDeleteUsersSearch') && filterTable('banDeleteUsersSearch', 'banDeleteUsersTable');
            document.getElementById('banDeleteOrgSearch') && filterTable('banDeleteOrgSearch', 'banDeleteOrgTable');
            document.getElementById('cardsSearch') && filterTable('cardsSearch', 'cardsTable');
            document.getElementById('approveOrganizationsSearch') && filterTable('approveOrganizationsSearch', 'approveOrganizationsTable');
            document.getElementById('reviewsSearch') && filterTable('reviewsSearch', 'reviewsTable');
            document.getElementById('testimonialsSearch') && filterTable('testimonialsSearch', 'testimonialsTable');

            function highlightActiveLink(activeLinkId) {
                const links = document.querySelectorAll('nav a');
                links.forEach(link => {
                    link.classList.remove('active');
                });
                document.getElementById(activeLinkId).classList.add('active');
            }

            document.getElementById('manageUsersLink').addEventListener('click', function() {
                highlightActiveLink('manageUsersLink');
                document.getElementById('greeting').style.display = 'none'; 
                document.getElementById('greetingDescription').style.display = 'none'; 
                document.getElementById('organizationsTableContainer').style.display = 'block'; 
                document.getElementById('cardsTableContainer').style.display = 'none';
                fetch('/api/admin/organizations')
                    .then(response => response.json())
                    .then(data => {
                        const tableBody = document.getElementById('organizationsTableBody');
                        tableBody.innerHTML = ''; 
                        data.forEach(org => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td class="py-2 px-4 border-b">${org.name_of_org}</td>
                                <td class="py-2 px-4 border-b">${org.email_of_org}</td>
                                <td class="py-2 px-4 border-b">${org.phone_number_of_org}</td>
                                <td class="py-2 px-4 border-b">${org.url_of_org || 'N/A'}</td> 
                                <td class="py-2 px-4 border-b">${org.description_of_org || 'N/A'}</td> 
                                <td class="py-2 px-4 border-b">
                                    <button onclick="approveOrganization(${org.id})" class="bg-green-500 text-white px-2 py-1 rounded">Approve</button>
                                    <button onclick="rejectOrganization(${org.id})" class="bg-red-500 text-white px-2 py-1 rounded">Reject</button>
                                </td>
                            `;
                            tableBody.appendChild(row);
                        });
                    });
            });

            document.getElementById('banDeleteUsersLink').addEventListener('click', function() {
                highlightActiveLink('banDeleteUsersLink');
                document.getElementById('greeting').style.display = 'none';
                document.getElementById('greetingDescription').style.display = 'none';
                document.getElementById('approveOrganizationsTableContainer').style.display = 'none';
                document.getElementById('cardsTableContainer').style.display = 'none';

                const banDeleteUsersTableContainer = document.getElementById('banDeleteUsersTableContainer');
                banDeleteUsersTableContainer.style.display = 'block';

                fetch('/api/admin/users')
                    .then(response => response.json())
                    .then(data => {
                        const tableBody = document.getElementById('banDeleteUsersTableBody');
                        tableBody.innerHTML = '';

                        data.forEach(user => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td class="py-2 px-4 border-b">${user.username}</td>
                                <td class="py-2 px-4 border-b">${user.email}</td>
                                <td class="py-2 px-4 border-b">${user.phone}</td>
                                <td class="py-2 px-4 border-b">${user.status || 'N/A'}</td>
                                <td class="py-2 px-4 border-b">
                                    <button onclick="banUser(${user.id})" class="bg-yellow-500 text-white px-2 py-1 rounded">Ban</button>
                                    <button onclick="deleteUser(${user.id})" class="bg-red-500 text-white px-2 py-1 rounded">Delete</button>
                                </td>
                            `;
                            tableBody.appendChild(row);
                        });
                    });
            });

            function deleteUser(userId) {
                if (confirm('Are you sure you want to delete this user?')) {
                    fetch(`/api/admin/users/delete/${userId}`, {
                        method: 'POST'
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        alert(data.message);
                        const tableBody = document.getElementById('usersTableBody');
                        const rowToDelete = document.querySelector(`tr[data-user-id="${userId}"]`);
                        if (rowToDelete) {
                            tableBody.removeChild(rowToDelete);
                        }
                        document.getElementById('banDeleteUsersLink').click();
                    })
                    .catch(error => {
                        console.error('There was a problem with the delete operation:', error);
                    });
                }
            }

            function banUser(userId) {
                console.log(`Attempting to ban user with ID: ${userId}`);
                if (confirm('Are you sure you want to ban this user?')) {
                    fetch(`/api/admin/users/ban/${userId}`, {
                        method: 'POST'
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        alert(data.message);
                        document.getElementById('banDeleteUsersLink').click();
                    })
                    .catch(error => {
                        console.error('Error banning user:', error);
                        alert('Failed to ban user. Please try again.');
                    });
                }
            }

            document.getElementById('banDeleteOrgLink').addEventListener('click', function() {
                highlightActiveLink('banDeleteOrgLink');
                document.getElementById('greeting').style.display = 'none';
                document.getElementById('greetingDescription').style.display = 'none';
                document.getElementById('approveOrganizationsTableContainer').style.display = 'none';
                document.getElementById('cardsTableContainer').style.display = 'none';

                const banDeleteOrgTableContainer = document.getElementById('banDeleteOrgTableContainer');
                banDeleteOrgTableContainer.style.display = 'block';

                fetch('/api/admin/organizations/all') 
                    .then(response => response.json())
                    .then(data => {
                        const tableBody = document.getElementById('banDeleteOrgTableBody');
                        tableBody.innerHTML = ''; 

                        data.forEach(org => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td class="py-2 px-4 border-b">${org.name_of_org}</td>
                                <td class="py-2 px-4 border-b">${org.email_of_org}</td>
                                <td class="py-2 px-4 border-b">${org.phone_number_of_org}</td>
                                <td class="py-2 px-4 border-b">${org.url_of_org}</td>
                                <td class="py-2 px-4 border-b">${org.description_of_org}</td>
                                <td class="py-2 px-4 border-b">${org.status || 'N/A'}</td>
                                <td class="py-2 px-4 border-b">
                                    <button onclick="banOrganization(${org.id})" class="bg-yellow-500 text-white px-2 py-1 rounded">Ban</button>
                                    <button onclick="deleteOrganization(${org.id})" class="bg-red-500 text-white px-2 py-1 rounded">Delete</button>
                                </td>
                            `;
                            tableBody.appendChild(row);
                        });
                    });
            });

            function deleteOrganization(orgId) {
                if (confirm('Are you sure you want to delete this organization?')) {
                    fetch(`/api/admin/organizations/delete/${orgId}`, {
                        method: 'POST'
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        alert(data.message);
                        document.getElementById('banDeleteOrgLink').click(); 
                    })
                    .catch(error => {
                        console.error('There was a problem with the delete operation:', error);
                    });
                }
            }

            function banOrganization(orgId) {
                if (confirm('Are you sure you want to ban this organization?')) {
                    fetch(`/api/admin/organizations/ban/${orgId}`, {
                        method: 'POST'
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        alert(data.message); 
                        document.getElementById('banDeleteOrgLink').click(); 
                    })
                    .catch(error => {
                        console.error('Error banning organization:', error);
                        alert('Failed to ban organization. Please try again.');
                    });
                }
            }

            function addTooltipToTruncatedCells() {
                const cells = document.querySelectorAll("td");

                cells.forEach(cell => {
                    if (cell.offsetWidth < cell.scrollWidth) {
                        cell.title = cell.textContent;
                    } else {
                        cell.title = "";                    
                    }
                });
            }

            let currentPage = 1; 
            const limit = 10; 
            let totalPage =0;


            function fetchCards(apiUrl, title, columns, page = 1) {
                currentApiUrl = apiUrl; 
                currentTitle = title; 
                currentColumns = columns; 
                currentPage = page;

                fetch(`${apiUrl}?page=${page}&limit=${limit}`)
                    .then(response => {
                        if (!response.ok) throw new Error('Network response was not ok');
                        return response.json();
                    })
                    .then(data => {
                        const { data: items, total } = data;
                        totalPage = Math.ceil(total / limit);

                        const tableBody = document.getElementById('cardsTableBody');
                        const cardsHeader = document.getElementById('cardsTableHeader');

                        tableBody.innerHTML = '';
                        cardsHeader.innerHTML = '';

                        document.getElementById('cardsHeader').textContent = title;

                        columns.forEach(col => {
                            const th = document.createElement('th');
                            th.innerHTML = `<b>${col}</b>`;
                            th.className = 'border-b';
                            cardsHeader.appendChild(th);
                        });

                        const actionHeader = document.createElement('th');
                        actionHeader.textContent = 'Actions';
                        actionHeader.className = 'border-b';
                        cardsHeader.appendChild(actionHeader);

                        items.forEach(item => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                ${columns.map(col => `<td class="py-2 px-4 border-b">${item[col.toLowerCase().replace(/ /g, "_")] || 'N/A'}</td>`).join('')}
                                <td class="py-2 px-4 border-b">
                                    <button onclick="editRow(${item.id}, this)" class="bg-blue-500 text-white px-2 py-1 rounded">Edit</button>
                                </td>
                            `;
                            tableBody.appendChild(row);
                        });

                        document.getElementById('cardsTableContainer').style.display = 'block';
                        addTooltipToTruncatedCells();
                        displayPaginationControls();
                    })
                    .catch(error => {
                        console.error('Error fetching data:', error);
                        alert('There was an error fetching data. Please try again later.');
                    });
            }

            function displayPaginationControls() {
                const paginationContainer = document.getElementById('paginationControls');
                paginationContainer.innerHTML = `
                    <button onclick="fetchCards(currentApiUrl, currentTitle, currentColumns, ${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>Previous</button>
                    <span>Page ${currentPage} of ${totalPage}</span>
                    <button onclick="fetchCards(currentApiUrl, currentTitle, currentColumns, ${currentPage + 1})" ${currentPage >= totalPage ? 'disabled' : ''}>Next</button>
                `;
            }

            function getTypeFromContext() {
                if (document.getElementById('internshipsLink').classList.contains('active')) {
                    return 'internships';
                } else if (document.getElementById('trainingsLink').classList.contains('active')) {
                    return 'trainings';
                } else if (document.getElementById('volunteeringLink').classList.contains('active')) {
                    return 'volunteering';
                } else if (document.getElementById('eventsLink').classList.contains('active')) {
                    return 'events';
                } else {
                    throw new Error('Invalid record type');
                }
            }

            function editRow(id, button) {
                const row = button.closest('tr');
                const columns = Array.from(row.children).slice(0, -1);
                const editForm = document.getElementById('editForm');
                
                editForm.innerHTML = '';

                const headerRow = document.getElementById('cardsTableHeader');
                const columnNames = Array.from(headerRow.children).map(header => header.textContent.toLowerCase().replace(/ /g, '_'));

                const editedData = {};

                columnNames.forEach((fieldName, index) => {
                    const cell = columns[index];

                    if (!cell) {
                        console.warn(`No cell found for column: ${fieldName}`);
                        return; 
                    }

                    const label = document.createElement('label');
                    label.classList.add('block', 'text-sm', 'font-medium', 'text-gray-700');
                    label.textContent = fieldName.charAt(0).toUpperCase() + fieldName.slice(1).replace(/_/g, ' '); 

                    const input = document.createElement('input');
                    input.type = 'text';
                    input.name = fieldName;
                    input.value = cell.textContent || '';
                    input.classList.add('mt-1', 'block', 'w-full', 'border', 'rounded', 'p-2', 'shadow-sm');

                    editedData[fieldName] = cell.textContent || '';

                    const wrapper = document.createElement('div');
                    wrapper.appendChild(label);
                    wrapper.appendChild(input);

                    editForm.appendChild(wrapper);
                });

                editedData.type = getTypeFromContext(); 
                document.getElementById('editModal').classList.remove('hidden');

                document.getElementById('saveButton').onclick = function () {
                    columnNames.forEach(fieldName => {
                        const inputField = editForm.querySelector(`input[name="${fieldName}"]`);
                        if (inputField) {
                            editedData[fieldName] = inputField.value; 
                        }
                    });

                    if (validateData(editedData)) {
                        editedData.id = id; 
                        console.log('Saving data:', editedData); 
                        saveEdit(editedData); 
                    } else {
                        alert('Please fill in all fields before saving.');
                    }
                };

                document.getElementById('cancelButton').onclick = function () {
                    closeModal();
                };
            }

            function closeModal() {
                document.getElementById('editModal').classList.add('hidden');
            }

            const editedData = {};
            function saveEdit(editedData) {
                console.log('Edited Data:', editedData);
                const apiEndpoint = getApiEndpoint(editedData.type, editedData.id);
                console.log('API Endpoint:', apiEndpoint);

                fetch(apiEndpoint, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(editedData)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Data updated successfully:', data);
                    updateUi(data);

                    document.getElementById('editModal').style.display = 'none';
                })
                .catch(error => {
                    console.error('Error updating data:', error);
                    alert('Failed to update data: ' + error.message);
                });
            }

            function validateData(data) {
                for (const key in data) {
                    if (data[key] === '' || data[key] === null) {
                        return false;
                    }
                }
                return true; 
            }
            function updateUi(data) {
                fetchCards(currentApiUrl, currentTitle, currentColumns);
            }

            function getApiEndpoint(type, id) {
                const baseUrl = '/api/admin/managecards/';
                const endpoints = {
                    internships: `${baseUrl}internships/${id}`,
                    trainings: `${baseUrl}training/${id}`,
                    volunteering: `${baseUrl}volunteering/${id}`,
                    events: `${baseUrl}events/${id}`,
                };

                if (endpoints[type]) {
                    return endpoints[type];
                } else {
                    throw new Error('Invalid record type');
                }
            }


            function cancelEdit(row) {
                window.location.reload();
            }

            document.getElementById('manageUsersLink').addEventListener('click', function() {
                highlightActiveLink('manageUsersLink');
                const submenu = document.getElementById('usersSubMenu');
                submenu.style.display = submenu.style.display === 'block' ? 'none' : 'block';
                        
                document.getElementById('greeting').style.display = 'none'; 
                document.getElementById('greetingDescription').style.display = 'none'; 
                document.getElementById('organizationsTableContainer').style.display = 'none'; 
                document.getElementById('usersTableContainer').style.display = 'none';
            });

            document.getElementById('manageCardsLink').addEventListener('click', function() {
                highlightActiveLink('manageCardsLink');
                const submenu = document.getElementById('cardsSubMenu');
                submenu.style.display = submenu.style.display === 'block' ? 'none' : 'block';
                        
                document.getElementById('greeting').style.display = 'none'; 
                document.getElementById('greetingDescription').style.display = 'none'; 
                document.getElementById('organizationsTableContainer').style.display = 'none'; 
                document.getElementById('cardsTableContainer').style.display = 'none';
            });

            document.getElementById('manageFeedbackLink').addEventListener('click', function() {
                highlightActiveLink('manageFeedbackLink');  // Corrected to manageFeedbackLink
                const submenu = document.getElementById('feedbackSubMenu');
                submenu.style.display = submenu.style.display === 'block' ? 'none' : 'block';
                
                document.getElementById('greeting').style.display = 'none'; 
                document.getElementById('greetingDescription').style.display = 'none'; 
                document.getElementById('organizationsTableContainer').style.display = 'none';
                document.getElementById('cardsTableContainer').style.display = 'none';
            });

            document.getElementById('internshipsLink').addEventListener('click', function(event) {
                event.stopPropagation();
                fetchCards('/api/admin/managecards/internships', 'Manage Internships', ['source', 'title', 'description', 'posted_date', 'salary', 'duration', 'location', 'image_url', 'email', 'phone_number', 'office_address', 'company_logo']);
                highlightActiveLink('internshipsLink');
                document.getElementById('greeting').style.display = 'none'; 
                document.getElementById('greetingDescription').style.display = 'none'; 
            });

            document.getElementById('trainingsLink').addEventListener('click', function(event) {
                event.stopPropagation();
                fetchCards('/api/admin/managecards/training', 'Manage Trainings', ['source', 'title', 'trainer', 'description', 'price', 'students', 'rating', 'image_url', 'duration', 'email', 'phone_number', 'office_address', 'company_logo']);
                highlightActiveLink('trainingsLink');
                document.getElementById('greeting').style.display = 'none'; 
                document.getElementById('greetingDescription').style.display = 'none'; 
            });

            document.getElementById('volunteeringLink').addEventListener('click', function(event) {
                event.stopPropagation();
                fetchCards('/api/admin/managecards/volunteering', 'Manage Volunteering', ['source', 'title', 'duration', 'cause', 'age_group', 'image_url', 'email', 'phone_number', 'office_address', 'company_logo']);
                highlightActiveLink('volunteeringLink');
                document.getElementById('greeting').style.display = 'none'; 
                document.getElementById('greetingDescription').style.display = 'none'; 
            });

            document.getElementById('eventsLink').addEventListener('click', function(event) {
                event.stopPropagation();
                fetchCards('/api/admin/managecards/events', 'Manage Events', ['source', 'organizer', 'title', 'duration', 'location', 'image_url', 'email', 'phone_number', 'office_address', 'company_logo']);
                highlightActiveLink('eventsLink');
                document.getElementById('greeting').style.display = 'none'; 
                document.getElementById('greetingDescription').style.display = 'none'; 
            });


            document.getElementById('approveOrganizationsLink').addEventListener('click', function(event) {
                event.stopPropagation();
                highlightActiveLink('approveOrganizationsLink');
                document.getElementById('greeting').style.display = 'none';
                document.getElementById('greetingDescription').style.display = 'none';
                document.getElementById('approveOrganizationsTableContainer').style.display = 'block';

                fetch('/api/admin/organizations')
                    .then(response => response.json())
                    .then(data => {
                        const tableBody = document.getElementById('approveOrganizationsTableBody');
                        tableBody.innerHTML = '';
                        data.forEach(org => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td class="py-2 px-4 border-b">${org.name_of_org}</td>
                                <td class="py-2 px-4 border-b">${org.email_of_org}</td>
                                <td class="py-2 px-4 border-b">${org.phone_number_of_org}</td>
                                <td class="py-2 px-4 border-b">${org.url_of_org || 'N/A'}</td>
                                <td class="py-2 px-4 border-b">${org.description_of_org || 'N/A'}</td>
                                <td class="py-2 px-4 border-b">
                                    <button onclick="approveOrganization(${org.id})" class="bg-green-500 text-white px-2 py-1 rounded">Approve</button>
                                    <button onclick="rejectOrganization(${org.id})" class="bg-red-500 text-white px-2 py-1 rounded">Reject</button>
                                </td>
                            `;
                            tableBody.appendChild(row);
                        });
                });
            });

            function approveOrganization(orgId) {
                fetch(`/api/admin/organizations/approve/${orgId}`, {
                    method: 'POST'
                }).then(response => {
                    if (response.ok) {
                        alert('Organization approved successfully.');
                        window.location.reload();
                    } else {
                        alert('Error approving organization.');
                    }
                });
            }

            function rejectOrganization(orgId) {
                fetch(`/api/admin/organizations/reject/${orgId}`, {
                    method: 'POST'
                }).then(response => {
                    if (response.ok) {
                        alert('Organization rejected successfully.');
                        window.location.reload();
                    } else {
                        alert('Error rejecting organization.');
                    }
                });
            }


            // Function to populate the Manage Reviews table
            function loadReviewsTable() {
                fetch('http://localhost:8080/api/retrieve_reviews')
                    .then(response => response.json())
                    .then(data => {
                        const reviewsTableBody = document.getElementById('reviewsTableBody');
                        reviewsTableBody.innerHTML = ''; 
                        
                        data.forEach(review => {
                            const row = document.createElement('tr');
                            
                            const usernameCell = document.createElement('td');
                            usernameCell.textContent = review.username;
                            usernameCell.className = "py-2 px-4 border-b";
                            row.appendChild(usernameCell);
                            
                            const reviewCell = document.createElement('td');
                            reviewCell.textContent = review.review;
                            reviewCell.className = "py-2 px-4 border-b";
                            row.appendChild(reviewCell);
                            
                            const actionsCell = document.createElement('td');
                            actionsCell.className = "py-2 px-4 border-b";
                            const deleteButton = document.createElement('button');
                            deleteButton.className = "bg-red-500 text-white px-3 py-1 rounded hover:bg-red-700";
                            deleteButton.textContent = "Delete";
                            
                            // Event listener for delete button
                            deleteButton.addEventListener('click', function() {
                                if (confirm(`Are you sure you want to delete the review from ${review.username}?`)) {
                                    deleteReview(review.username);
                                }
                            });
                            
                            actionsCell.appendChild(deleteButton);
                            row.appendChild(actionsCell);
                            
                            reviewsTableBody.appendChild(row);
                        });
                    })
                    .catch(error => console.error('Error loading reviews:', error));
            }

            // Function to delete review by username
            function deleteReview(username) {
                fetch('http://localhost:8080/api/delete_review', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username })
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                    loadReviewsTable(); // Refresh the table after deletion
                })
                .catch(error => console.error('Error deleting review:', error));
            }



            function resetSections() {
                const sections = [
                    'banDeleteUsersTableContainer', 
                    'banDeleteOrgTableContainer', 
                    'cardsTableContainer', 
                    'approveOrganizationsTableContainer',
                    'manageReviewsTableContainer', // Added Manage Reviews section
                    'manageTestimonialsTableContainer' // Added Manage Testimonials section
                ];

                sections.forEach(sectionId => {
                    document.getElementById(sectionId).style.display = 'none';
                });
            }

            // Add event listeners for all menu links, calling resetSections() before showing each section
            document.getElementById('banDeleteUsersLink').addEventListener('click', function() {
                resetSections(); 
                document.getElementById('banDeleteUsersTableContainer').style.display = 'block';
            });

            document.getElementById('banDeleteOrgLink').addEventListener('click', function() {
                resetSections(); 
                document.getElementById('banDeleteOrgTableContainer').style.display = 'block';
            });

            document.getElementById('internshipsLink').addEventListener('click', function() {
                resetSections(); 
                document.getElementById('cardsTableContainer').style.display = 'block';
            });

            document.getElementById('eventsLink').addEventListener('click', function() {
                resetSections(); 
                document.getElementById('cardsTableContainer').style.display = 'block';
            });

            document.getElementById('trainingsLink').addEventListener('click', function() {
                resetSections(); 
                document.getElementById('cardsTableContainer').style.display = 'block';
            });

            document.getElementById('volunteeringLink').addEventListener('click', function() {
                resetSections(); 
                document.getElementById('cardsTableContainer').style.display = 'block';
            });

            document.getElementById('approveOrganizationsLink').addEventListener('click', function() {
                resetSections(); 
                document.getElementById('approveOrganizationsTableContainer').style.display = 'block';  
            });

            document.getElementById('manageReviewsLink').addEventListener('click', function() {
                highlightActiveLink('manageReviewsLink');
                loadReviewsTable();
                resetSections(); 
                document.getElementById('manageReviewsTableContainer').style.display = 'block';
            });

            document.getElementById('manageTestimonialsLink').addEventListener('click', function() {
                highlightActiveLink('manageTestimonialsLink');
                resetSections(); 
                document.getElementById('manageTestimonialsTableContainer').style.display = 'block';
            });
    
        </script>

        <script>
                document
                .getElementById("logoutButton")
                .addEventListener("click", function () {
                    fetch("/api/admin/logout", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    })
                    .then((response) => response.json())
                    .then((data) => {
                        if (data.success) {
                        window.location.href = "/admin/login";
                        } else {
                        alert(data.error);
                        }
                    });
                });
        </script>

  </body>
</html>
